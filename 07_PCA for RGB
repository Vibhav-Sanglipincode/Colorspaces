# Load libraries
library(tidyverse)
library(ggfortify)
library(viridis)
library(patchwork)

# Step 1: Load data
data <- read.csv("C:/Users/vibha/Downloads/Glaucidium Plumage analysis - Plottable RGB & HSV values (norm = _255.csv")  # replace with actual path

# Step 2: Function to run PCA per Region
run_rgb_pca_plot <- function(df, region_name) {
  df_sub <- df %>% filter(Region == region_name)
  
  # Run PCA on RGB columns
  pca <- prcomp(df_sub[, c("Red", "Green", "Blue")], scale. = TRUE)
  
  # Plot
  autoplot(pca,
           data = df_sub,
           colour = "Subspecie",
           shape = "Subspecie",
           size = 4,
           alpha = 0.8) +
    labs(title = paste("PCA of RGB -", region_name)) +
    scale_color_viridis(discrete = TRUE) +
    theme_minimal()
}

# Step 3: Unique regions
regions <- unique(data$Region)

# Step 4: Create plots per region and combine
p_list <- map(regions, ~run_rgb_pca_plot(data, .x))
wrap_plots(p_list, ncol = 1) + plot_layout(guides = "collect")
