# Load libraries
library(tidyverse)
library(ggfortify)
library(patchwork)

# Step 1: Load data
data <- read.csv("C:/Users/vibha/Downloads/Indian Black Bird Plumage - RGB + HSV Values.csv")  # replace with actual path

# Step 2: Define your custom color palette
custom_colors <- c(
  "Nigropileus"  = "#84BD00",
  "Bourdilloni"  = "#CC0C00",
  "Simillimus"   = "#5C88DA",
  "Spencei"      = "#7C878EFF",
  "Kinnisii"     = "#FFCD00"
)

# Step 3: Function to run PCA per Region
run_rgb_pca_plot <- function(df, region_name) {
  df_sub <- df %>%
    filter(Region == region_name) %>%
    mutate(Subspecie = str_to_title(Subspecie))  # Ensuring title case matches palette keys
  
  pca <- prcomp(df_sub[, c("Red", "Green", "Blue")], scale. = TRUE)
  
  autoplot(pca,
           data = df_sub,
           colour = "Subspecie",
           #shape = "Subspecie",
           size = 4,
           alpha = 0.8) +
    labs(title = paste("PCA of RGB -", region_name)) +
    scale_color_manual(values = custom_colors) +
    theme_minimal()
}

# Step 4: Generate plots per region and combine
regions <- unique(data$Region)
p_list <- map(regions, ~run_rgb_pca_plot(data, .x))
wrap_plots(p_list, ncol = 1) + plot_layout(guides = "collect")
